<!doctype html>
<html lang=en>
  <head>
    <title>Leaflet SVGMarker Demo</title>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/2.0.0-alpha.1/leaflet.css"/>
    <link rel='icon' href='favicon.svg'>
    
    <!-- Glyph fonts -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel='stylesheet' href='https://cdn.boxicons.com/fonts/basic/boxicons.min.css' />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.css">
    <style> 
      html, body, #mapdiv { 
        height: 100%;
        width: 100%;
        padding: 0px;
        margin: 0px;
        overflow: hidden;
      }
      .shiny path { fill: url(#shine); }
      .pulse {
        animation: pulse-animation 0.7s infinite alternate;
        animation-timing-function: ease-in-out;
      }
      @keyframes pulse-animation {
        0% { fill: hsl(256, 50%, 40%); /* A darker blue */ }
        100% { fill: hsl(256, 50%, 90%); /* A lighter blue */ }
      }
      
    </style>
  </head>
  <body>
    <div id="mapdiv"></div>
    
    <script type="importmap">
      {
        "imports": {
            "leaflet": "https://unpkg.com/leaflet@2.0.0-alpha.1/dist/leaflet.js"
        }
      }
    </script>
    <script type="module">
      import {Map, TileLayer, Marker, Popup} from 'leaflet';
      import SVGMarker from "../SVGMarkers.mjs";

      function manymarkers(n=100) {
          let count = n, stack = [], lat, lng;
          const bounds = map.getBounds();
          const west = bounds.getWest();
          const east = bounds.getEast();
          const north = bounds.getNorth();
          const south = bounds.getSouth();
          const start_old = new Date();
          while (--count) {
            lat = (Math.random() * (north - south)) + south;
            lng = (Math.random() * ( west - east )) + east; 
            let m = new Marker([lat, lng]);
            stack.push(m);
            m.addTo(map);
          }
          const stop_old = new Date();
          count = n;
          while (--count) {
            lat = (Math.random() * (north - south)) + south;
            lng = (Math.random() * ( west - east )) + east; 
            let m = new SVGMarker([lat, lng]);
            stack.push(m)
            m.addTo(map);
          }
          const stop_new = new Date();
          const old_took = stop_old - start_old;
          const new_took = stop_new - stop_old;
          const popup = new Popup().setLatLng(map.getCenter())
          .setContent(`<p>${n} L.Markers took ${old_took} ms<br/>${n} SVGMarkers took ${new_took} msec</p>`);
          setTimeout(() => { popup.openOn(map); }, 1000);
          setTimeout(() => { for (let k of stack) k.removeFrom(map) }, 2000);
          setTimeout(() => { map.closePopup(); }, 6000);
      }

      // Create a map in the "map" div, set the view to Berlin
      const map = new Map('mapdiv').setView([52.5, 13.4], 14);

      // add an OpenStreetMap tile layer
      new TileLayer('https://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(map);

      const mPop = function(latlng, options, text="") {
          let m = new SVGMarker(latlng, options);
          if (text.length) { text += "<br/>" }
          let Pop;
          if (options) {
              Pop = m.bindPopup(text + JSON.stringify(options, null, 2).replaceAll('\n','<br/>').replaceAll(' ', '&nbsp;'));
          } else {
              Pop = m.bindPopup(text);
          }
          return Pop;
      }

      // class 'shiny' references an SVG gradient
      mPop([52.505, 13.39], {class: 'shiny'}, "SVG gradient").addTo(map);
      // available shapes are square, penta, and pin
      mPop([52.505, 13.395], {shape: 'square', color: 'orange', glyph: 'bx-burger-alt', glyphColor: 'black'}).addTo(map);
      mPop([52.505, 13.4], {dotColor: 'yellow'}).addTo(map);
      mPop([52.505, 13.405], {shape: 'penta', color: 'red', glyph: 'bx-pizza-alt'}).addTo(map);
      mPop([52.505, 13.41], {glyph: 'fa-bank'}).addTo(map);
      // colors can be anything CSS understands (#hex, rgb, hsl, etc)
      mPop([52.5, 13.39], {color: '#000000', glyph: 'bi-tsunami', glyphColor: 'yellow'}).addTo(map);
      mPop([52.5, 13.395], {number: 3, color: 'black'}).addTo(map);
      // define complicated classes in your CSS ( or add adoptedStyleSheets )
      mPop([52.5, 13.4], {class: 'pulse'}, "CSS gradient").addTo(map);
      mPop([52.5, 13.405], undefined, "Vanilla SVGMarker").addTo(map)
      mPop([52.5, 13.41], {shape: 'pin', color: 'hsl(120, 100%, 50%)'}).addTo(map);
      mPop([52.495, 13.39], {stroke: 'red', 'stroke-width': '1px'}).addTo(map);
      mPop([52.495, 13.395], {image: './wetland.svg', imageOpts: {width: '15', height:'15'}}).addTo(map);
      mPop([52.495, 13.4], {glyph: 'bx-bed', color: 'gold', glyphColor: 'black'}).addTo(map);
      // if you use 'style', it embeds a stylesheet.  The stylesheet becomes 
      // globally available, not just for the SVG where it is defined.
      mPop([52.495, 13.405], {color:'red',style:'.ghost {opacity:0.4;filter:blur(3px);}',class:'ghost'}).addTo(map);
      // The number can be any character, even unicode.
      mPop([52.495, 13.41], {color:'white',number:"\u03c0",glyphColor:'red'}).addTo(map);

      setTimeout(() => { 
        manymarkers(250);
      }, 10000);
    </script>
    <!--
            The animated gradient used in the upper left marker
            with class "shiny".  To use SVG gradients you have to 
            mix CSS with an SVG def.  Usually easier to just use CSS
    -->
    <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 10 10">
      <linearGradient id="shine" 
                      spreadMethod="repeat" 
                      gradientTransform="rotate(20)" >
        <animate attributeName="y2" 
                 values="1;1.5;1;0.75;1" 
                 dur="2s" 
                 repeatDur="indefinite" />
        <animate attributeName="x1" 
                 values="0;0.5;0" 
                 dur="3s" 
                 repeatDur="indefinite" />
        <stop offset="0" stop-color="Goldenrod" /> 
        <stop offset="0.25" stop-color="lightYellow" />
        <stop offset="0.5" stop-color="Goldenrod" />
        <stop offset="0.75" stop-color="OrangeRed" />
        <stop offset="1" stop-color="Goldenrod" />
      </linearGradient>
    </svg>

    <!-- github-corners -->
    <a href="https://github.com/almamigratoria-netizen/Leaflet-SVGMarkers" class="github-corner" aria-label="View source on GitHub" style="z-index:1000;">
      <svg width="80" height="80" viewBox="0 0 250 250" style="z-index:1000;fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/>
      </svg>
    </a>
    <style>
      .github-corner:hover .octo-arm {
        animation:octocat-wave 560ms ease-in-out
      }
      @keyframes octocat-wave {
        0%,100% {
          transform:rotate(0)
        }
        20%,60% {
          transform:rotate(-25deg)
        }
        40%,80% {
          transform:rotate(10deg)
        }
      }
      @media (max-width:500px) {
        .github-corner:hover .octo-arm {
          animation:none
        }
        .github-corner .octo-arm {
          animation:octocat-wave 560ms ease-in-out
        }
      }
    </style>
    <!-- end github-corners -->
  </body>
</html>

